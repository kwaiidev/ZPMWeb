{% load static %}
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <title>TUNA - ZPM</title>
</head>

<body class="bg-[#F0F0DB] text-[#30364F]">
    <header
        class="fixed left-0 right-0 top-0 z-10 flex h-[70px] items-center justify-between border-b-4 border-[#ACBAC4] bg-[#30364F] px-6">
        <a href="{% url 'home' %}" class="text-lg font-semibold tracking-[0.3em] text-[#F0F0DB] hover:text-[#ACBAC4] transition-colors">>ZPM</a>

        <ul id="navId"
            class="fixed right-0 top-[70px] hidden h-[calc(100vh-70px)] w-[min(320px,70vw)] flex-col items-center justify-center gap-6 bg-[#30364F] px-6 py-8 text-[#E1D9BC] md:static md:flex md:h-auto md:w-auto md:flex-row md:justify-end md:bg-transparent md:p-0">
        </ul>
        <button class="burger text-[#E1D9BC] md:hidden" type="button" aria-label="Toggle navigation">
            <i class="fas fa-bars text-xl"></i>
        </button>
    </header>

    <main class="pt-[70px]">
        <section id="about-tuna" class="px-6 py-16">
            <div class="mx-auto max-w-6xl">
                <div class="mb-8">
                    <p class="text-sm uppercase tracking-[0.3em] text-[#ACBAC4]">ZPM</p>
                    <h1 class="text-4xl font-semibold text-[#30364F]">TUNA</h1>
                    <div class="mt-2 h-1 w-[100px] bg-[#ACBAC4]"></div>
                </div>
                <div class="grid gap-8 md:grid-cols-2">
                    <div class="text-sm leading-relaxed text-[#30364F]/80">
                        <p>
                            Tunas by nature are obligate ram ventilators. They must move fast in order to survive. Tuna are schooling fish, they use their lateral line, a sensory organ that detects movement in water, to react to each others movement. ZPM-TUNA gets its name from this same ideology, ZPM nodes are designed to react fast, and be versatile when it comes to life or death scenarios.
                        </p>
                        <p class="mt-4">
                            Decentralized, peer-to-peer communication allows tuna nodes to react to each others movement, and make desicions based on what others sense. This allows for the swarm to create dynamic escape paths, help users avoid obstacles, and find potentially endangered people.
                        </p>
                    </div>
                    <div class="text-sm leading-relaxed text-[#30364F]/80">
                        <video class="w-full h-full object-cover" autoplay muted loop playsinline>
                            <source src="{% static 'images/videoplayback.mp4' %}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            </div>
        </section>

        <section id="tuna-display"
            class="bg-[#ACBAC4] bg-fixed bg-[radial-gradient(circle_at_top_left,rgba(240,240,219,0.35),transparent_55%),radial-gradient(circle_at_bottom_right,rgba(48,54,79,0.15),transparent_55%)] px-6 py-16 text-[#30364F]">
            <div class="mx-auto max-w-6xl">
                <div
                    id="system-status"
                    class="mt-4 w-full max-w-md rounded-xl border border-[#E1D9BC] bg-[#F0F0DB]/80 p-5 backdrop-blur shadow-lg shadow-[#30364F]/10">
                    <p class="text-xs font-bold uppercase tracking-widest text-[#ACBAC4]">
                        System Status
                    </p>

                    <div class="mt-2 flex items-center gap-3">
                        <span id="status-dot" class="h-3 w-3 rounded-full bg-gray-400"></span>
                        <span id="swarm-state" class="text-lg font-semibold text-[#30364F]">—</span>
                    </div>

                    <p class="mt-2 text-sm text-[#30364F]">
                        Active Nodes:
                        <span id="active-nodes" class="font-semibold">—</span>
                    </p>
                </div>
            </div>
        </section>
    </main>


    <script src="{% static 'js/navbar.js' %}?v=2"></script>
    <script>
        async function loadSystemStatus() {
            try {
                const res = await fetch("/api/status/");
                const data = await res.json();

                document.getElementById("swarm-state").textContent = data.swarm_state;
                document.getElementById("active-nodes").textContent = data.active_nodes;

                const dot = document.getElementById("status-dot");

                if (data.swarm_state === "OPERATIONAL") {
                    dot.className = "h-3 w-3 rounded-full bg-green-500";
                } else if (data.swarm_state === "DEGRADED") {
                    dot.className = "h-3 w-3 rounded-full bg-yellow-500";
                } else {
                    dot.className = "h-3 w-3 rounded-full bg-red-500";
                }
            } catch (err) {
                console.error("Failed to load system status", err);
            }
        }

        loadSystemStatus();
        setInterval(loadSystemStatus, 5000);
    </script>
</body>

</html>
